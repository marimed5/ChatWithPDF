<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat with Your PDF</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: #0a1128;
        color: #e6f1ff;
        display: grid;
        place-items: center;
        height: 100vh;
      }
      .container {
        display: flex;
        flex-direction: column;
        width: 90%;
        max-width: 800px;
        height: 90vh;
        background: #121f3d;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
      }
      .chat-box {
        flex: 1;
        padding: 1.5em;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .message {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        line-height: 1.4;
        font-size: 0.95em;
      }
      .user {
        background: #1a3a8f;
        margin-left: auto;
        border-top-right-radius: 4px;
      }
      .bot {
        background: #0d1b2a;
        margin-right: auto;
        border-top-left-radius: 4px;
      }
      .input-area {
        padding: 12px;
        background: #0a1128;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      .input-bar {
        display: flex;
        gap: 8px;
      }
      input[type="text"] {
        flex: 1;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: #121f3d;
        color: white;
      }
      button,
      label.upload-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        cursor: pointer;
        border: none;
        background: #4e9af1;
        color: white;
      }
      label.upload-btn {
        background: transparent;
        border: 1px solid rgba(78, 154, 241, 0.3);
      }
      input[type="file"] {
        display: none;
      }
      .filename {
        text-align: center;
        padding: 8px;
        color: #8a9bb8;
        background: rgba(10, 17, 40, 0.7);
      }
      .filename a {
        color: #4e9af1;
        text-decoration: none;
      }
      .filename a:hover {
        text-decoration: underline;
        color: #82cfff;
      }
      .icon {
        width: 20px;
        height: 20px;
        fill: currentColor;
      }
      .loading-dots {
        animation: blink 1.5s infinite;
      }
      @keyframes blink {
        50% {
          opacity: 0.2;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      {% if filename %}
      <div class="filename">
        Current PDF:
        <strong>
          <a
            href="{{ url_for('static', filename='uploads/' + filename + '.pdf') }}"
            target="_blank"
          >
            {{ filename }}
          </a>
        </strong>
      </div>
      {% endif %}
      <div class="chat-box">
        {% for role, msg in history %}
        <div class="message {{ role }}" data-content="{{ msg }}">{{ msg }}</div>
        {% endfor %}
      </div>
      <div class="input-area">
        <form method="POST" enctype="multipart/form-data" class="input-bar">
          <label for="file" class="upload-btn" title="Attach PDF">
            <svg class="icon" viewBox="0 0 24 24">
              <path
                d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"
              />
            </svg>
          </label>
          <input
            type="file"
            id="file"
            name="pdf"
            onchange="this.form.submit()"
            accept="application/pdf"
          />
          <input
            type="text"
            name="query"
            placeholder="Ask a question about your PDF..."
            autocomplete="off"
          />
          <button type="submit" title="Send">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
            </svg>
          </button>
        </form>
      </div>
    </div>
    <script>
      document.querySelector("form").addEventListener("submit", function (e) {
        const query = this.querySelector('input[name="query"]').value.trim();
        if (query) {
          const chatBox = document.querySelector(".chat-box");
          chatBox.innerHTML += `
        <div class="message user">${query}</div>
        <div class="message bot loading-dots">...</div>
      `;
          chatBox.scrollTop = chatBox.scrollHeight;
          input.value = "";
        }
      });
    </script>
  </body>
</html>
